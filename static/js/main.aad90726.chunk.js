(this["webpackJsonptwitch-background"]=this["webpackJsonptwitch-background"]||[]).push([[0],{10:function(t,e,n){},12:function(t,e,n){"use strict";n.r(e);var a=n(0),c=n.n(a),o=n(4),r=n.n(o),i=(n(9),n(2)),s=n.p+"static/media/logo.6ce24c58.svg",u=(n(10),"CANCELED"),d="FULFILLED",l=function(t,e,n,a,c){fetch("https://api.twitch.tv/helix/channel_points/custom_rewards/redemptions?broadcaster_id=".concat(e,"&reward_id=").concat(n,"&id=").concat(a,"}"),{method:"PATCH",body:JSON.stringify({status:c}),headers:{"client-id":t,Authorization:"Bearer ".concat(sessionStorage.twitchOAuthToken),"Content-type":"application/json;"}}).then((function(t){return t.json()})).then((function(t){return console.log(t)}))},h=n(1),g="5styqm5roq5f90rfyylk9fezdiu1mm";var b=function(){var t=Object(a.useState)(!1),e=Object(i.a)(t,2),n=e[0],c=e[1],o=Object(a.useState)("/twitch-background"),r=Object(i.a)(o,2),b=r[0],O=r[1],f=Object(a.useState)(),p=Object(i.a)(f,2),j=p[0],S=p[1],w=Object(a.useState)({r:102,g:0,b:204}),m=Object(i.a)(w,2),v=m[0],k=m[1],N=Object(a.useState)({r:255,g:255,b:255}),y=Object(i.a)(N,2),I=y[0],x=y[1],C=Object(a.useState)({r:255,g:255,b:255}),A=Object(i.a)(C,2),L=A[0],T=A[1],D=Object(a.useState)({r:255,g:255,b:255}),E=Object(i.a)(D,2),F=E[0],_=E[1],R=Object(a.useState)(0),J=Object(i.a)(R,2),P=J[0],z=J[1],B=Object(a.useRef)(),H=Object(a.useCallback)((function(){return sessionStorage.twitchOAuthState=M(15),"https://id.twitch.tv/oauth2/authorize?response_type=token&client_id="+g+"&redirect_uri=https://samkitkat.github.io/twitch-background/&state="+sessionStorage.twitchOAuthState+"&scope=channel:read:redemptions%20user:read:email%20channel:manage:redemptions"}),[]),M=function(t){for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=0;a<t;a++)e+=n.charAt(Math.floor(Math.random()*n.length));return e},q=Object(a.useCallback)((function(t){var e={type:"LISTEN",nonce:M(15),data:{topics:["channel-points-channel-v1.".concat(t)],auth_token:sessionStorage.twitchOAuthToken}};console.log((new Date).toLocaleString(),"SENT:",e),B.current.send(JSON.stringify(e))}),[]),G=function(){B.current.send(JSON.stringify({type:"PING"}))},U=Object(a.useCallback)((function(){var t,e=!1;B.current=new WebSocket("wss://pubsub-edge.twitch.tv"),B.current.onopen=function(e){console.log((new Date).toLocaleString(),"INFO: Socket Opened"),G(),t=setInterval(G,6e4)},B.current.onerror=function(t){console.error((new Date).toLocaleString(),"ERR:",t)},B.current.onmessage=function(t){var n=this,a=JSON.parse(t.data),c=a.data&&a.data.message;if(c&&(a=JSON.parse(c)),console.log((new Date).toLocaleString(),"RECV:",a,"USER_ID:",j),"PONG"===a.type&&(e||fetch("https://api.twitch.tv/helix/users",{headers:{Authorization:"Bearer ".concat(sessionStorage.twitchOAuthToken),"Client-Id":g}}).then((function(t){return t.json()})).then((function(t){return S(t.data[0].id),t.data[0].id})).then((function(t){e=!0,q(t)}))),"RECONNECT"===a.type&&(console.log((new Date).toLocaleString(),"INFO: Reconnecting..."),setTimeout(U,3e3)),"reward-redeemed"===a.type){var o=function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16),valid:!0}:{r:0,g:0,b:0,valid:!1}}(a.data.redemption.user_input);if(j){if(!o.valid)return void l(g,j,a.data.redemption.reward.id,a.data.redemption.id,u);a.data.redemption.reward.title.includes("gradient")&&(0===P?k(o):1===P?x(o):2===P?T(o):3===P&&_(o),z((function(t){return t>3?0:n.setState({InputHex:n.state.InputHex+1})})),l(g,j,a.data.redemption.reward.id,a.data.redemption.id,d))}}},B.current.onclose=function(){console.log((new Date).toLocaleString(),"INFO: Socket Closed"),clearInterval(t),console.log((new Date).toLocaleString(),"INFO: Reconnecting..."),setTimeout(U,3e3),e=!1}}),[B,q,j,P]);return Object(a.useEffect)((function(){document.location.hash.match(/access_token=(\w+)/)&&function(t){var e=function(e){var n=t.match(e);return n?n[1]:null},n=e(/state=(\w+)/);sessionStorage.twitchOAuthState===n&&(sessionStorage.twitchOAuthToken=e(/access_token=(\w+)/))}(document.location.hash),sessionStorage.twitchOAuthToken?(U(),c(!0)):(O(H()),c(!1))}),[H,U]),Object(h.jsx)("div",{className:"header",style:{background:"linear-gradient(60deg, rgba(".concat(v.r,",").concat(v.g,",").concat(v.b,") 0%, rgba(").concat(I.r,",").concat(I.g,",").concat(I.b,"), \n        rgba(").concat(L.r,",").concat(L.g,",").concat(L.b,"), rgba(").concat(F.r,",").concat(F.g,",").concat(F.b,") 100%) 0% 0% / 400% 400%"),animation:"gradient 20s ease infinite",animationDirection:"alternate"},children:Object(h.jsx)("div",{className:"inner-header flex",children:Object(h.jsx)("div",{className:"container",children:Object(h.jsx)("div",{className:"row",children:Object(h.jsxs)("div",{style:{display:n?"none":"block"},className:"auth text-center",children:[Object(h.jsx)("p",{children:"First, connect with your Twitch Account:"}),Object(h.jsx)("a",{id:"auth-link",href:b,children:Object(h.jsx)("img",{src:s,alt:"logo"})})]})})})})})},O=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,13)).then((function(e){var n=e.getCLS,a=e.getFID,c=e.getFCP,o=e.getLCP,r=e.getTTFB;n(t),a(t),c(t),o(t),r(t)}))};r.a.render(Object(h.jsx)(c.a.StrictMode,{children:Object(h.jsx)(b,{})}),document.getElementById("root")),O()},9:function(t,e,n){}},[[12,1,2]]]);
//# sourceMappingURL=main.aad90726.chunk.js.map